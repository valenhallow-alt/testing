-- Rarity and Variety options
local RARITY_OPTIONS = {"Normal", "Rare", "Epic", "Legendary", "Mythic", "Secret"}
local VARIETY_OPTIONS = {"Normal", "Golden", "Diamond", "Glitch", "Galaxy", "????"}

-- Default: all selected
local selectedRarities = {}
local selectedVarieties = {}
for _, v in ipairs(RARITY_OPTIONS) do selectedRarities[string.lower(v)] = true end
for _, v in ipairs(VARIETY_OPTIONS) do selectedVarieties[string.lower(v)] = true end

-- Helper to copy a list (Rayfield expects a table of strings for CurrentOption)
local function copyList(tbl)
    local out = {}
    for i, v in ipairs(tbl) do out[i] = v end
    return out
end

-- Corrected Rarities dropdown (multi-select)
local RaritiesDropdown = StatusTab:CreateDropdown({
    Name = "Rarities",
    Options = RARITY_OPTIONS,
    CurrentOption = copyList(RARITY_OPTIONS), -- table of selected strings
    MultipleOptions = true,                   -- enable multi-select
    Flag = "RaritiesFilter",
    Callback = function(selection)
        -- selection is a table of selected strings
        selectedRarities = {}
        if type(selection) == "table" then
            for _, s in ipairs(selection) do
                if type(s) == "string" then
                    selectedRarities[string.lower(s)] = true
                end
            end
        end
    end,
})

-- Corrected Varieties dropdown (multi-select)
local VarietiesDropdown = StatusTab:CreateDropdown({
    Name = "Varieties",
    Options = VARIETY_OPTIONS,
    CurrentOption = copyList(VARIETY_OPTIONS),
    MultipleOptions = true,
    Flag = "VarietiesFilter",
    Callback = function(selection)
        selectedVarieties = {}
        if type(selection) == "table" then
            for _, s in ipairs(selection) do
                if type(s) == "string" then
                    selectedVarieties[string.lower(s)] = true
                end
            end
        end
    end,
})
