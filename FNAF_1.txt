-- Safely destroy any previously created Rayfield UI (put this before loading the library)
if _G.RayfieldInstance then
    pcall(function()
        if type(_G.RayfieldInstance.Destroy) == "function" then
            _G.RayfieldInstance:Destroy()
        end
    end)
    _G.RayfieldInstance = nil
end

-- Consolidated script with lounge fixes applied
local Rayfield = loadstring(game:HttpGet('https://raw.githubusercontent.com/UnHub-LEGO/Scripts/refs/heads/main/Rayfield%20Library'))()
_G.RayfieldInstance = Rayfield

local Window = Rayfield:CreateWindow({
   Name = "My Frog Pond",
   FileName = "UnHub",
   Icon = 0,
   Theme = "DarkBlue",
   ToggleUIKeybind = "H",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = nil,
      FileName = "UnHub"
   },
   Discord = {
      Enabled = false,
      Invite = "",
      RememberJoins = true
   },
   KeySystem = false,
   KeySettings = {
      Title = "UnHub",
      Subtitle = "Key",
      Note = "Get the key by visit the website and wait 5 sec copy the key",
      FileName = "Key",
      SaveKey = false,
      GrabKeyFromSite = false,
      Key = {"Hi"}
    }
})

local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local plr = game.Players.LocalPlayer
local Players = game.Players
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Feature toggles / state
local AutoBuyTadpoles, AutoPickUp, AutoBuyGears, RunAntiAfk = false, false, false, nil
local BuyLoungeItems = false
local PlaceAllTadpoles = false
local AutoSell = false
local IgnorePickupFor = {} -- table of selected names to ignore

-- Controller tokens for background tasks
local controllers = {
    BuyLounge = { token = 0 },
    AutoBuyTadpoles = { token = 0 },
    AutoBuyGears = { token = 0 }
}

-- Anti-AFK: always enabled (no toggle in UI)
do
    local vu = game:GetService("VirtualUser")
    RunAntiAfk = game:GetService("Players").LocalPlayer.Idled:Connect(function()
        vu:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
        wait(1)
        vu:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
    end)
end

local multipliers = {
    K = 1e3,
    M = 1e6,
    B = 1e9,
    T = 1e12
}

local function NumberCoverter(text)
    text = tostring(text):upper()
    local value, suffix = text:match("([%d%.]+)%s*([KMBT]?)")
    value = tonumber(value)
    if not value then return nil end
    if suffix ~= "" and multipliers[suffix] then
        return value * multipliers[suffix]
    end
    return value
end

-- Tadpole shop display order (user-specified)
local TadpoleOptions = {
    "Pond Tadpole","Wood Tadpole","Dewback Tadpole","Bullfrog Tadpole","Dart Tadpole",
    "Mossback Tadpole","Frogberry Tadpole","Budtop Tadpole","Mushtoad Tadpole","Sugar Tadpole",
    "Glacier Tadpole","Molten Tadpole","Chronogear Tadpole","Voltcloud Tadpole","Crystalback Tadpole",
    "Shadow Hopper Tadpole","Astro Tadpole","Candelune Tadpole","Frogzilla Tadpole","Cheeseburger Tadpole",
    "Runesage Tadpole","Arcana Tadpole","Moltrix Tadpole","Bunblossom Tadpole","Jester Tadpole","Archangel Tadpole"
}

-- Exact frog/toad display names for ignore list (user-specified, exact order/spelling)
local FrogNames = {
    "Pond Frog","Wood Frog","Dewback Frog","Bullfrog","Dart Frog","Mossback Frog","Frogberry",
    "Budtop Frog","Mushtoad","Sugar Frog","Glacier Frog","Molten Toad","Chronogear Toad",
    "Voltcloud Toad","Crystalback Toad","Shadow Hopper","Astro Frog","Candelune Toad",
    "Frogzilla","Cheeseburger Frog","Runesage Frog","Arcana Toad","Moltrix Toad",
    "Bunblossom Frog","Jester Frog","Archangel Frog"
}

-- Shop data containers (will be populated at runtime)
local Frog = {}
local FrogList = {}
local ShopFrog = {}

local Lilypad = {}
local LilypadList = {}

local Ribbit = {}
local RibbitList = {}
local ShopRibbit = {}

-- Pending selection holder for "Select All Lounge Items" when UI created before Lounge tab
local PendingLoungeSelect = {
    apply = false,
    Objects = nil,
    Pathways = nil,
    Fences = nil,
    Plants = nil,
    Rocks = nil,
    Buildings = nil,
    Arches = nil,
    Lighting = nil
}

-- Robust shop refresh (safe, idempotent)
local function refreshShopData()
    -- Tadpoles (Frog)
    pcall(function()
        Frog = {}
        FrogList = {}
        ShopFrog = ShopFrog or {}
        if plr and plr.PlayerGui and plr.PlayerGui:FindFirstChild("Tadpole Trove_Shop") then
            local ok, container = pcall(function()
                return plr.PlayerGui["Tadpole Trove_Shop"].MainContainer.Container.Frame.Body.Items
            end)
            if ok and container then
                for _, v in pairs(container:GetChildren()) do
                    if v and v:IsA("Frame") and tostring(v.Name):find(" Tadpole") then
                        local price = 0
                        pcall(function()
                            price = tonumber(NumberCoverter(v.Right.PriceSection.Button.Amount.Text)) or 0
                        end)
                        table.insert(Frog, {v.Name, v.Name:gsub(" Tadpole", " Frog"), price})
                    end
                end
                for _, entry in pairs(Frog) do table.insert(FrogList, entry[1]) end
            end
        end
    end)

    -- Ribbit (Gears)
    pcall(function()
        Ribbit = {}
        RibbitList = {}
        ShopRibbit = ShopRibbit or {}
        if plr and plr.PlayerGui and plr.PlayerGui:FindFirstChild("Ribbit Rack_Shop") then
            local ok, container = pcall(function()
                return plr.PlayerGui["Ribbit Rack_Shop"].MainContainer.Container.Frame.Body.Items
            end)
            if ok and container then
                for _, v in pairs(container:GetChildren()) do
                    if v and v:IsA("Frame") then
                        local price = 0
                        pcall(function()
                            price = tonumber(NumberCoverter(v.Right.PriceSection.Button.Amount.Text)) or 0
                        end)
                        table.insert(Ribbit, {v.Name, price})
                    end
                end
                for _, entry in pairs(Ribbit) do table.insert(RibbitList, entry[1]) end
            end
        end
    end)

    -- Lilypad (Lounge)
    pcall(function()
        Lilypad = {}
        LilypadList = {}
        if plr and plr.PlayerGui and plr.PlayerGui:FindFirstChild("Lilypad Lounge_Shop") then
            local ok, container = pcall(function()
                return plr.PlayerGui["Lilypad Lounge_Shop"].MainContainer.Container.Frame.Body.Items
            end)
            if ok and container then
                for _, v in pairs(container:GetChildren()) do
                    if v and v:IsA("Frame") then
                        local price = 0
                        pcall(function()
                            price = tonumber(NumberCoverter(v.Right.PriceSection.Button.Amount.Text)) or 0
                        end)
                        table.insert(Lilypad, {v.Name, price})
                    end
                end
                for _, entry in pairs(Lilypad) do table.insert(LilypadList, entry[1]) end
            end
        end
    end)
end

-- Call once at startup to populate if GUIs are already present
pcall(function() refreshShopData() end)

-- Helper: safe invoke purchase for tadpoles
local function tryPurchaseTadpole(name, mappedName)
    pcall(function()
        ReplicatedStorage:WaitForChild("TadpoleShopComms"):WaitForChild("RF"):WaitForChild("OnPurchaseItem"):InvokeServer(name, mappedName)
    end)
end

-- Helper: safe invoke purchase for ribbit/gear
local function tryPurchaseGear(name)
    pcall(function()
        ReplicatedStorage:WaitForChild("GearShopComms"):WaitForChild("RF"):WaitForChild("OnPurchaseItem"):InvokeServer(name)
    end)
end

-- Helper: safe invoke purchase for lilypad lounge (single call using EXACT remote pattern requested)
local function tryPurchaseLoungeOnce(name)
    pcall(function()
        local args = { name }
        ReplicatedStorage:WaitForChild("LilypadLoungeComms"):WaitForChild("RF"):WaitForChild("OnPurchaseItem"):InvokeServer(unpack(args))
    end)
end

-- Start/stop helper for Buy Lounge Items (one item at a time, 3 attempts each)
local function startBuyLoungeTask()
    controllers.BuyLounge.token = controllers.BuyLounge.token + 1
    local myToken = controllers.BuyLounge.token
    task.spawn(function()
        while BuyLoungeItems and controllers.BuyLounge.token == myToken do
            -- Ensure shop data exists
            if not Lilypad or #Lilypad == 0 then
                refreshShopData()
            end

            -- Build ordered list of selected names (preserve order from dropdowns where possible)
            local selectedOrdered = {}
            local seen = {}

            local function addIfSelected(list)
                for _, name in ipairs(list or {}) do
                    if name and name ~= "None" and name ~= "" and not seen[name] then
                        seen[name] = true
                        table.insert(selectedOrdered, name)
                    end
                end
            end

            -- Read selections safely (these variables are set by dropdown callbacks)
            pcall(function()
                addIfSelected(LoungeObjects)
                addIfSelected(LoungePathways)
                addIfSelected(LoungeFences)
                addIfSelected(LoungePlants)
                addIfSelected(LoungeRocks)
                addIfSelected(LoungeBuildings)
                addIfSelected(LoungeArches)
                addIfSelected(LoungeLighting)
            end)

            if #selectedOrdered == 0 then
                task.wait(0.8)
            else
                for _, itemName in ipairs(selectedOrdered) do
                    if not BuyLoungeItems or controllers.BuyLounge.token ~= myToken then break end

                    -- Validate item exists in Lilypad list; refresh once if not found
                    local existsInShop = false
                    for _, entry in ipairs(Lilypad or {}) do
                        if entry and entry[1] == itemName then
                            existsInShop = true
                            break
                        end
                    end
                    if not existsInShop then
                        refreshShopData()
                        for _, entry in ipairs(Lilypad or {}) do
                            if entry and entry[1] == itemName then
                                existsInShop = true
                                break
                            end
                        end
                    end

                    if not existsInShop then
                        pcall(function() print("[LoungeBuyer] Skipping unknown item:", itemName) end)
                        task.wait(0.05)
                    else
                        -- Check affordability
                        local itemPrice = 0
                        for _, entry in ipairs(Lilypad or {}) do
                            if entry and entry[1] == itemName then
                                itemPrice = tonumber(entry[2]) or 0
                                break
                            end
                        end
                        local canAfford = false
                        pcall(function()
                            if plr and plr:FindFirstChild("leaderstats") and plr.leaderstats:FindFirstChild("Ribbles") then
                                canAfford = NumberCoverter(plr.leaderstats.Ribbles.Value) >= itemPrice
                            end
                        end)

                        if not canAfford then
                            pcall(function() print("[LoungeBuyer] Cannot afford:", itemName, "price:", itemPrice) end)
                            task.wait(0.05)
                        else
                            pcall(function() print("[LoungeBuyer] Purchasing (3x):", itemName) end)
                            for i = 1, 3 do
                                if not BuyLoungeItems or controllers.BuyLounge.token ~= myToken then break end
                                pcall(function()
                                    local args = { itemName }
                                    ReplicatedStorage:WaitForChild("LilypadLoungeComms"):WaitForChild("RF"):WaitForChild("OnPurchaseItem"):InvokeServer(unpack(args))
                                end)
                                task.wait(0.02)
                            end
                            task.wait(0.2)
                        end
                    end
                end
                task.wait(0.6)
            end
        end
    end)
end

-- Start/stop helpers for Auto Buy Tadpoles and Gears (keeps original behavior but uses controllers)
local function startAutoBuyTadpoles()
    controllers.AutoBuyTadpoles.token = controllers.AutoBuyTadpoles.token + 1
    local myToken = controllers.AutoBuyTadpoles.token
    task.spawn(function()
        while AutoBuyTadpoles and controllers.AutoBuyTadpoles.token == myToken do
            if #Frog == 0 then refreshShopData() end
            local currentRibbles = 0
            pcall(function()
                if plr and plr:FindFirstChild("leaderstats") and plr.leaderstats:FindFirstChild("Ribbles") then
                    currentRibbles = NumberCoverter(plr.leaderstats.Ribbles.Value) or 0
                end
            end)
            for _, v in pairs(Frog) do
                if not AutoBuyTadpoles or controllers.AutoBuyTadpoles.token ~= myToken then break end
                local tadName = v[1]
                local mappedName = v[2]
                local price = tonumber(v[3]) or 0
                if ShopFrog and table.find(ShopFrog, tadName) and currentRibbles >= price then
                    tryPurchaseTadpole(tadName, mappedName)
                    task.wait(0.2)
                end
            end
            task.wait(0.6)
        end
    end)
end

local function startAutoBuyGears()
    controllers.AutoBuyGears.token = controllers.AutoBuyGears.token + 1
    local myToken = controllers.AutoBuyGears.token
    task.spawn(function()
        while AutoBuyGears and controllers.AutoBuyGears.token == myToken do
            if #Ribbit == 0 then refreshShopData() end
            local currentRibbles = 0
            pcall(function()
                if plr and plr:FindFirstChild("leaderstats") and plr.leaderstats:FindFirstChild("Ribbles") then
                    currentRibbles = NumberCoverter(plr.leaderstats.Ribbles.Value) or 0
                end
            end)
            for _, v in pairs(Ribbit) do
                if not AutoBuyGears or controllers.AutoBuyGears.token ~= myToken then break end
                local gearName = v[1]
                local price = tonumber(v[2]) or 0
                if ShopRibbit and table.find(ShopRibbit, gearName) and currentRibbles >= price then
                    tryPurchaseGear(gearName)
                    task.wait(0.2)
                end
            end
            task.wait(0.6)
        end
    end)
end

-- MAIN tab: Buy Lounge Items + Auto Buy Tadpoles + Auto Buy Gears
local Main = Window:CreateTab("Main", 125058207637011)
Main:CreateSection("Main")

Main:CreateToggle({
    Name = "Buy Lounge Items",
    CurrentValue = false,
    Flag = "Buy_Lounge_Items",
    Callback = function(Value)
        BuyLoungeItems = Value
        if Value then
            startBuyLoungeTask()
        else
            controllers.BuyLounge.token = controllers.BuyLounge.token + 1
        end
    end,
})

Main:CreateToggle({
    Name = "Auto Buy Tadpoles",
    CurrentValue = false,
    Flag = "Auto_Buy_Tadpoles",
    Callback = function(Value)
        AutoBuyTadpoles = Value
        if Value then
            startAutoBuyTadpoles()
        else
            controllers.AutoBuyTadpoles.token = controllers.AutoBuyTadpoles.token + 1
        end
    end,
})

Main:CreateToggle({
    Name = "Auto Buy Gears",
    CurrentValue = false,
    Flag = "Auto_Buy_Gears",
    Callback = function(Value)
        AutoBuyGears = Value
        if Value then
            startAutoBuyGears()
        else
            controllers.AutoBuyGears.token = controllers.AutoBuyGears.token + 1
        end
    end,
})

-- FARM tab
local Farm = Window:CreateTab("Farm", 125058207637011)
Farm:CreateSection("Farm")

Farm:CreateToggle({Name = "Auto Sell All", CurrentValue = false, Flag = "Auto_Sell_All", Callback = function(Value)
    AutoSell = Value
end})

Farm:CreateToggle({Name = "Auto Pick Up", CurrentValue = false, Flag = "Auto_Pick_Up", Callback = function(Value)
    AutoPickUp = Value
end})

-- Ignore Pickup dropdown: display order matches Tadpoles Trove (use FrogNames as requested)
local IgnoreDropdown = Farm:CreateDropdown({
    Name = "Ignore Pickup for",
    Options = FrogNames,
    CurrentOption = {"None"},
    MultipleOptions = true,
    Flag = "Ignore_Pickup_For",
    Callback = function(Value)
        IgnorePickupFor = Value or {}
    end
})

-- Place All Tadpoles: changed from button to toggle
Farm:CreateToggle({
    Name = "Place All Tadpoles",
    CurrentValue = false,
    Flag = "Place_All_Tadpoles",
    Callback = function(Value)
        PlaceAllTadpoles = Value
        if Value then
            task.spawn(function()
                while PlaceAllTadpoles do
                    local containers = {}
                    if plr and plr.Backpack then
                        for _, item in pairs(plr.Backpack:GetChildren()) do table.insert(containers, item) end
                    end
                    if plr and plr.Character then
                        for _, item in pairs(plr.Character:GetChildren()) do table.insert(containers, item) end
                    end

                    for _, v in pairs(containers) do
                        if not PlaceAllTadpoles then break end
                        if v and v:FindFirstChild("TadpoleToolComms") then
                            pcall(function()
                                local args = {
                                    plr.Plot.Value:WaitForChild("SwimableAreas"):WaitForChild("Pond1"):WaitForChild("PlaceArea"),
                                    vector.create(0, 0, 0)
                                }
                                v:WaitForChild("TadpoleToolComms"):WaitForChild("RE"):WaitForChild("RequestPlace"):FireServer(unpack(args))
                            end)
                            task.wait(0.35)
                        end
                    end

                    task.wait(1)
                end
            end)
        end
    end
})

Farm:CreateButton({Name = "Sell All", Callback = function()
    ReplicatedStorage:WaitForChild("HopNSellComms"):WaitForChild("RE"):WaitForChild("SellAll"):FireServer()
end})

-- SHOP tab (Lilypad dropdown removed; Tadpoles and Ribbit remain)
local Shop = Window:CreateTab("Shop", 125058207637011)
Shop:CreateSection("Shop")

-- Tadpoles Trove dropdown (display order as requested)
local Tadpoles = Shop:CreateDropdown({
    Name = "Tadpoles Trove",
    Options = TadpoleOptions,
    CurrentOption = {"None"},
    MultipleOptions = true,
    Flag = "Dropdown_Tadpoles",
    Callback = function(Value)
        ShopFrog = Value
    end
})

Shop:CreateButton({Name = "Select All Tadpoles", Callback = function()
    Tadpoles:Set(TadpoleOptions)
end})

-- Divider between Tadpole Trove and Ribbit Rack
Shop:CreateDivider()

-- Ribbit Rack dropdown: display order set as requested
local RibbitOptions = {
    "Frog Labeler","Dripleaf Pad","Emberleaf Pad","Azureleaf Pad","Bug Spray",
    "Swamp Soother","Pondlight Orb","Frogtag Charm","Runechime Pillar","Pondmother's Phial","Asterveil Catalyst"
}

local RibbitDrop = Shop:CreateDropdown({
    Name = "Ribbit Rack",
    Options = RibbitOptions,
    CurrentOption = {"None"},
    MultipleOptions = true,
    Flag = "Dropdown_Ribbit",
    Callback = function(Value)
        ShopRibbit = Value
    end
})

-- Rename Select All Ribbit to "Select All Gears"
Shop:CreateButton({Name = "Select All Gears", Callback = function()
    RibbitDrop:Set(RibbitOptions)
end})

-- NEW divider for the lounge buttons section
Shop:CreateDivider()

-- Move the lounge select/clear buttons into the Shop tab (new divided section)
Shop:CreateButton({Name = "Select All Lounge Items", Callback = function()
    local applyNow = (ddObjects ~= nil) and (ddPath ~= nil) and (ddFence ~= nil) and (ddPlant ~= nil) and (ddRock ~= nil) and (ddBuild ~= nil) and (ddArch ~= nil) and (ddLight ~= nil)
    if applyNow then
        ddObjects:Set(ObjectsOptions)
        ddPath:Set(PathwaysOptions)
        ddFence:Set(FencesOptions)
        ddPlant:Set(PlantsOptions)
        ddRock:Set(RocksOptions)
        ddBuild:Set(BuildingsOptions)
        ddArch:Set(ArchesOptions)
        ddLight:Set(LightingOptions)
        -- update selection variables
        LoungeObjects = ObjectsOptions
        LoungePathways = PathwaysOptions
        LoungeFences = FencesOptions
        LoungePlants = PlantsOptions
        LoungeRocks = RocksOptions
        LoungeBuildings = BuildingsOptions
        LoungeArches = ArchesOptions
        LoungeLighting = LightingOptions
        -- small deferred re-apply to ensure UI highlights
        task.defer(function()
            task.wait(0.05)
            if ddObjects and type(ddObjects.Set) == "function" then ddObjects:Set(ObjectsOptions) end
            task.wait(0.02)
            if ddPath and type(ddPath.Set) == "function" then ddPath:Set(PathwaysOptions) end
            task.wait(0.02)
            if ddFence and type(ddFence.Set) == "function" then ddFence:Set(FencesOptions) end
            task.wait(0.02)
            if ddPlant and type(ddPlant.Set) == "function" then ddPlant:Set(PlantsOptions) end
            task.wait(0.02)
            if ddRock and type(ddRock.Set) == "function" then ddRock:Set(RocksOptions) end
            task.wait(0.02)
            if ddBuild and type(ddBuild.Set) == "function" then ddBuild:Set(BuildingsOptions) end
            task.wait(0.02)
            if ddArch and type(ddArch.Set) == "function" then ddArch:Set(ArchesOptions) end
            task.wait(0.02)
            if ddLight and type(ddLight.Set) == "function" then ddLight:Set(LightingOptions) end
        end)
    else
        PendingLoungeSelect.apply = true
        PendingLoungeSelect.Objects = ObjectsOptions
        PendingLoungeSelect.Pathways = PathwaysOptions
        PendingLoungeSelect.Fences = FencesOptions
        PendingLoungeSelect.Plants = PlantsOptions
        PendingLoungeSelect.Rocks = RocksOptions
        PendingLoungeSelect.Buildings = BuildingsOptions
        PendingLoungeSelect.Arches = ArchesOptions
        PendingLoungeSelect.Lighting = LightingOptions
    end
end})

Shop:CreateButton({Name = "Unselect all Lounge Items", Callback = function()
    local applyNow = (ddObjects ~= nil) and (ddPath ~= nil) and (ddFence ~= nil) and (ddPlant ~= nil) and (ddRock ~= nil) and (ddBuild ~= nil) and (ddArch ~= nil) and (ddLight ~= nil)
    if applyNow then
        ddObjects:Set({})
        ddPath:Set({})
        ddFence:Set({})
        ddPlant:Set({})
        ddRock:Set({})
        ddBuild:Set({})
        ddArch:Set({})
        ddLight:Set({})
        LoungeObjects = {}
        LoungePathways = {}
        LoungeFences = {}
        LoungePlants = {}
        LoungeRocks = {}
        LoungeBuildings = {}
        LoungeArches = {}
        LoungeLighting = {}
    else
        PendingLoungeSelect.apply = true
        PendingLoungeSelect.Objects = {}
        PendingLoungeSelect.Pathways = {}
        PendingLoungeSelect.Fences = {}
        PendingLoungeSelect.Plants = {}
        PendingLoungeSelect.Rocks = {}
        PendingLoungeSelect.Buildings = {}
        PendingLoungeSelect.Arches = {}
        PendingLoungeSelect.Lighting = {}
    end
end})

-- LOUNGE tab and dropdowns (Lilypad items sorted into categories)
local Lounge = Window:CreateTab("Lounge", 125058207637011)
Lounge:CreateSection("Lounge")

local ObjectsOptions = {
    "Barrel","Frogbreeze Chime","Fruit Crate","Ladder","Log","Log Sapling","Log Stack","Short Log",
    "Tree Trunk","Wooden Wheelbarrow","Shelf","Small Haystack","Large Haystack","Book Stack",
    "Wooden Bench","Book","Mossy Frog Hut","Mossmuffin Abode","Mushroom Cottage","Small Duck",
    "Duck","Acornwhisk Hut","Well","Watch Tower"
}

local PathwaysOptions = {
    "Cobble Path","Mossrock Path","Plank Steps","Rockleaf Path","Softwood Path","Stone Path",
    "Wornwood Path","Log Steps","Log Path","Brick Steps","Mosscobble Path","Pebblestone Path","Blossom Path"
}

local FencesOptions = {
    "Twigweave Fence","Wooden Fence","Mossrail Fence","Sproutstick Fence","Bloomtwig Fence"
}

local PlantsOptions = {
    "Giant Lilypad","Lilypad","Mushroom","Mushroom Cluster","Short Cattails","Starpetal Ferns",
    "Cattails","Dewdrop Lilies","Faelight Petals","Lilypad Umbrella","Bellblossoms","Lotus"
}

local RocksOptions = {
    "Rock cluster","Rocks","Small Rocks","Grass Mound","Mossy Rocks"
}

local BuildingsOptions = {
    "Plank Wall [1x1]","Plank Wall [3x1]","Plank Wall Plank Wall [3x2]","Wooden Pillar",
    "Wooden Wall [1x1]","Wooden Wall [3x1]","Wooden Wall [3x2]","Wooden Window",
    "Willowplank Wall [1x1]","Willowplank Wall [3x1]","Willowplank Wall [3x2]","Charwood Pillar",
    "Charwood Wall [3x1]","Charwood Wall [1x1]","Logstack Wall [1x1]","Logstack Wall [3x1]",
    "Logstack Wall [3x2]","Splitstone Wall [3x1]","Splitstone Wall [3x1]","Splitstone Wall [1x1]"
}

local ArchesOptions = {
    "Mossy Rock Arch","Rocky Arch","Wooden Arbor","Flower Ivy Arch","Rustic Wood Arbor",
    "Mushroom Arch","Willowvine Arch"
}

local LightingOptions = {
    "Mossy Latern","Latern","Stone Latern","Wooden Lamp Post","Candle","Candle Cluster",
    "Domeglow Lantern","Whisperlight Lantern","Firefly Lantern","Glowcap Lamp Post"
}

-- Variables to hold current selections
local LoungeObjects, LoungePathways, LoungeFences, LoungePlants, LoungeRocks, LoungeBuildings, LoungeArches, LoungeLighting =
    {}, {}, {}, {}, {}, {}, {}, {}

-- Create dropdowns (multiple choice)
local ddObjects = Lounge:CreateDropdown({Name = "Objects",   Options = ObjectsOptions,   CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Objects",   Callback = function(Value) LoungeObjects   = Value end})
local ddPath   = Lounge:CreateDropdown({Name = "Pathways",  Options = PathwaysOptions,  CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Pathways",  Callback = function(Value) LoungePathways  = Value end})
local ddFence  = Lounge:CreateDropdown({Name = "Fences",    Options = FencesOptions,    CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Fences",    Callback = function(Value) LoungeFences    = Value end})
local ddPlant  = Lounge:CreateDropdown({Name = "Plants",    Options = PlantsOptions,    CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Plants",    Callback = function(Value) LoungePlants    = Value end})
local ddRock   = Lounge:CreateDropdown({Name = "Rocks",     Options = RocksOptions,     CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Rocks",     Callback = function(Value) LoungeRocks     = Value end})
local ddBuild  = Lounge:CreateDropdown({Name = "Buildings", Options = BuildingsOptions, CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Buildings", Callback = function(Value) LoungeBuildings = Value end})
local ddArch   = Lounge:CreateDropdown({Name = "Arches",    Options = ArchesOptions,    CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Arches",    Callback = function(Value) LoungeArches    = Value end})
local ddLight  = Lounge:CreateDropdown({Name = "Lighting",  Options = LightingOptions,  CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Lighting",  Callback = function(Value) LoungeLighting  = Value end})

-- If there were pending "Select All" actions queued before the Lounge UI existed, apply them now
task.defer(function()
    if PendingLoungeSelect.apply then
        if PendingLoungeSelect.Objects then ddObjects:Set(PendingLoungeSelect.Objects); LoungeObjects = PendingLoungeSelect.Objects end
        if PendingLoungeSelect.Pathways then ddPath:Set(PendingLoungeSelect.Pathways); LoungePathways = PendingLoungeSelect.Pathways end
        if PendingLoungeSelect.Fences then ddFence:Set(PendingLoungeSelect.Fences); LoungeFences = PendingLoungeSelect.Fences end
        if PendingLoungeSelect.Plants then ddPlant:Set(PendingLoungeSelect.Plants); LoungePlants = PendingLoungeSelect.Plants end
        if PendingLoungeSelect.Rocks then ddRock:Set(PendingLoungeSelect.Rocks); LoungeRocks = PendingLoungeSelect.Rocks end
        if PendingLoungeSelect.Buildings then ddBuild:Set(PendingLoungeSelect.Buildings); LoungeBuildings = PendingLoungeSelect.Buildings end
        if PendingLoungeSelect.Arches then ddArch:Set(PendingLoungeSelect.Arches); LoungeArches = PendingLoungeSelect.Arches end
        if PendingLoungeSelect.Lighting then ddLight:Set(PendingLoungeSelect.Lighting); LoungeLighting = PendingLoungeSelect.Lighting end
        PendingLoungeSelect.apply = false
    end

    -- Extra attempts to force UI highlight (some Rayfield dropdowns need a tiny delay)
    task.wait(0.05)
    if ddObjects and type(ddObjects.Set) == "function" and LoungeObjects and #LoungeObjects > 0 then ddObjects:Set(LoungeObjects) end
    task.wait(0.02)
    if ddPath and type(ddPath.Set) == "function" and LoungePathways and #LoungePathways > 0 then ddPath:Set(LoungePathways) end
    task.wait(0.02)
    if ddFence and type(ddFence.Set) == "function" and LoungeFences and #LoungeFences > 0 then ddFence:Set(LoungeFences) end
    task.wait(0.02)
    if ddPlant and type(ddPlant.Set) == "function" and LoungePlants and #LoungePlants > 0 then ddPlant:Set(LoungePlants) end
    task.wait(0.02)
    if ddRock and type(ddRock.Set) == "function" and LoungeRocks and #LoungeRocks > 0 then ddRock:Set(LoungeRocks) end
    task.wait(0.02)
    if ddBuild and type(ddBuild.Set) == "function" and LoungeBuildings and #LoungeBuildings > 0 then ddBuild:Set(LoungeBuildings) end
    task.wait(0.02)
    if ddArch and type(ddArch.Set) == "function" and LoungeArches and #LoungeArches > 0 then ddArch:Set(LoungeArches) end
    task.wait(0.02)
    if ddLight and type(ddLight.Set) == "function" and LoungeLighting and #LoungeLighting > 0 then ddLight:Set(LoungeLighting) end

    -- Debug: print the current Lilypad shop items so we can confirm name matching
    pcall(function()
        print("[LoungeDebug] Lilypad shop items:")
        for i, entry in ipairs(Lilypad or {}) do
            print(i, entry[1], entry[2])
        end
    end)
end)

-- Suppress the "Cannot pick up a favorited frog." alert by removing UI elements that contain that text.
do
    local TARGET_TEXT = "Cannot pick up a favorited frog"
    local function checkAndRemove(desc)
        if not desc or not desc.Parent then return end
        local ok, isText = pcall(function()
            return desc:IsA("TextLabel") or desc:IsA("TextButton") or desc:IsA("TextBox")
        end)
        if ok and isText then
            local text = ""
            pcall(function() text = tostring(desc.Text or "") end)
            if text:find(TARGET_TEXT) then
                pcall(function()
                    local parent = desc.Parent
                    for i = 1, 4 do
                        if parent == nil then break end
                        if parent:IsA("ScreenGui") or parent:IsA("Frame") or parent:IsA("ImageLabel") then
                            parent:Destroy()
                            return
                        end
                        parent = parent.Parent
                    end
                    desc:Destroy()
                end)
            end
        end
    end

    pcall(function()
        for _, d in pairs(game:GetService("CoreGui"):GetDescendants()) do
            checkAndRemove(d)
        end
    end)

    pcall(function()
        if plr and plr:FindFirstChild("PlayerGui") then
            for _, d in pairs(plr.PlayerGui:GetDescendants()) do
                checkAndRemove(d)
            end
        end
    end)

    pcall(function()
        game:GetService("CoreGui").DescendantAdded:Connect(function(desc)
            task.defer(function()
                checkAndRemove(desc)
            end)
        end)
    end)

    pcall(function()
        if plr and plr:FindFirstChild("PlayerGui") then
            plr.PlayerGui.DescendantAdded:Connect(function(desc)
                task.defer(function()
                    checkAndRemove(desc)
                end)
            end)
        end
    end)
end

Rayfield:LoadConfiguration()
