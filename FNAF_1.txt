-- UnHub | by LE_GO89 (updated: Tadpole order + Auto Buy Tadpoles moved to Main)
local Rayfield = loadstring(game:HttpGet('https://raw.githubusercontent.com/UnHub-LEGO/Scripts/refs/heads/main/Rayfield%20Library'))()

local Window = Rayfield:CreateWindow({
   Name = "UnHub | by LE_GO89",
   FileName = "UnHub",
   Icon = 0,
   LoadingTitle = "UnHub",
   LoadingSubtitle = "by LE_GO89",
   Theme = "Default",
   ToggleUIKeybind = "H",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = nil,
      FileName = "UnHub"
   },
   Discord = {
      Enabled = false,
      Invite = "",
      RememberJoins = true
   },
   KeySystem = false,
   KeySettings = {
      Title = "UnHub",
      Subtitle = "Key",
      Note = "Get the key by visit the website and wait 5 sec copy the key",
      FileName = "Key",
      SaveKey = false,
      GrabKeyFromSite = false,
      Key = {"Hi"}
    }
})

local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local plr = game.Players.LocalPlayer
local Players = game.Players
local AutoBuy1, AutoPickUp, AutoBuy3, RunAntiAfk = false, false, false, nil
local BuyLoungeItems = false

-- Anti-AFK: always enabled (no toggle in UI)
do
    local vu = game:GetService("VirtualUser")
    RunAntiAfk = game:GetService("Players").LocalPlayer.Idled:Connect(function()
        vu:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
        wait(1)
        vu:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
    end)
end

local multipliers = {
    K = 1e3,
    M = 1e6,
    B = 1e9,
    T = 1e12
}

local function NumberCoverter(text)
    text = tostring(text):upper()

    local value, suffix = text:match("([%d%.]+)%s*([KMBT]?)")
    value = tonumber(value)
    if not value then return nil end

    if suffix ~= "" and multipliers[suffix] then
        return value * multipliers[suffix]
    end

    return value
end

-- Build Frog (Tadpole) shop data from GUI
local Frog = {}
local FrogList = {}
local ShopFrog = {}

if plr and plr.PlayerGui and plr.PlayerGui:FindFirstChild("Tadpole Trove_Shop") then
    for i, v in pairs(plr.PlayerGui["Tadpole Trove_Shop"].MainContainer.Container.Frame.Body.Items:GetChildren()) do
        if v:IsA("Frame") and v.Name:find(" Tadpole") then
            table.insert(Frog, {v.Name, v.Name:gsub(" Tadpole", " Frog"), tonumber(NumberCoverter(v.Right.PriceSection.Button.Amount.Text))})
        end
    end
    for i, v in pairs(Frog) do
        table.insert(FrogList, v[1])
    end
end

-- Lilypad shop items (used by Buy Lounge Items)
local Lilypad = {}
local LilypadList = {}

if plr and plr.PlayerGui and plr.PlayerGui:FindFirstChild("Lilypad Lounge_Shop") then
    for i, v in pairs(plr.PlayerGui["Lilypad Lounge_Shop"].MainContainer.Container.Frame.Body.Items:GetChildren()) do
        if v:IsA("Frame") then
            table.insert(Lilypad, {v.Name, tonumber(NumberCoverter(v.Right.PriceSection.Button.Amount.Text))})
        end
    end
    for i, v in pairs(Lilypad) do
        table.insert(LilypadList, v[1])
    end
end

-- Ribbit shop
local Ribbit = {}
local RibbitList = {}
local ShopRibbit = {}

if plr and plr.PlayerGui and plr.PlayerGui:FindFirstChild("Ribbit Rack_Shop") then
    for i, v in pairs(plr.PlayerGui["Ribbit Rack_Shop"].MainContainer.Container.Frame.Body.Items:GetChildren()) do
        if v:IsA("Frame") then
            table.insert(Ribbit, {v.Name, tonumber(NumberCoverter(v.Right.PriceSection.Button.Amount.Text))})
        end
    end
    for i, v in pairs(Ribbit) do
        table.insert(RibbitList, v[1])
    end
end

-- MAIN tab: Buy Lounge Items + Auto Buy Tadpoles (Anti-AFK remains enabled)
local Main = Window:CreateTab("Main", 125058207637011)
Main:CreateSection("Main")

Main:CreateToggle({
    Name = "Buy Lounge Items",
    CurrentValue = false,
    Flag = "Buy_Lounge_Items",
    Callback = function(Value)
        BuyLoungeItems = Value
    end,
})

-- Auto Buy Tadpoles moved to Main and renamed
Main:CreateToggle({
    Name = "Auto Buy Tadpoles",
    CurrentValue = false,
    Flag = "Auto_Buy_Tadpoles",
    Callback = function(Value)
        AutoBuy1 = Value
    end,
})

-- FARM tab
local Farm = Window:CreateTab("Farm", 125058207637011)
Farm:CreateSection("Farm")

Farm:CreateToggle({Name = "Auto Sell All", CurrentValue = false, Flag = "Toggle1", Callback = function(Value)
    AutoSell = Value
end})

Farm:CreateToggle({Name = "Auto Pick Up", CurrentValue = false, Flag = "Toggle1", Callback = function(Value)
    AutoPickUp = Value
end})

Farm:CreateButton({Name = "Pick Up All", Callback = function()
    for i, v in pairs(plr.Plot.Value.Entities:GetChildren()) do
        if v:IsA("Part") then
            task.spawn(function()
                game:GetService("ReplicatedStorage"):WaitForChild("FrogPickupComms"):WaitForChild("RE"):WaitForChild("Pickup"):FireServer(v)
            end)
        end
    end
end})

Farm:CreateButton({Name = "Sell All", Callback = function()
    game:GetService("ReplicatedStorage"):WaitForChild("HopNSellComms"):WaitForChild("RE"):WaitForChild("SellAll"):FireServer()
end})

Farm:CreateButton({Name = "Place All Tadpole", Callback = function()
    -- iterate over Backpack and Character to find tadpole tools
    local containers = {}
    for _, item in pairs(plr.Backpack:GetChildren()) do table.insert(containers, item) end
    if plr.Character then
        for _, item in pairs(plr.Character:GetChildren()) do table.insert(containers, item) end
    end

    for _, v in pairs(containers) do
        if v:FindFirstChild("TadpoleToolComms") then
            task.spawn(function()
                local success, err = pcall(function()
                    local args = {
                        plr.Plot.Value:WaitForChild("SwimableAreas"):WaitForChild("Pond1"):WaitForChild("PlaceArea"),
                        vector.create(0, 0, 0)
                    }
                    v:WaitForChild("TadpoleToolComms"):WaitForChild("RE"):WaitForChild("RequestPlace"):FireServer(unpack(args))
                end)
                if not success then
                    -- optional: warn in output if needed
                    -- warn("Place All Tadpole error: "..tostring(err))
                end
            end)
        end
    end
end})

-- SHOP tab (Lilypad dropdown removed; Tadpoles and Ribbit remain)
local Shop = Window:CreateTab("Shop", 125058207637011)
Shop:CreateSection("Shop")

-- Tadpole dropdown: use explicit display order requested by user
local TadpoleOptions = {
    "Pond Tadpole","Wood Tadpole","Dewback Tadpole","Bullfrog Tadpole","Dart Tadpole",
    "Mossback Tadpole","Frogberry Tadpole","Budtop Tadpole","Mushtoad Tadpole","Sugar Tadpole",
    "Glacier Tadpole","Molten Tadpole","Chronogear Tadpole","Voltcloud Tadpole","Crystalback Tadpole",
    "Shadow Hopper Tadpole","Astro Tadpole","Candelune Tadpole","Frogzilla Tadpole","Cheeseburger Tadpole",
    "Runesage Tadpole","Arcana Tadpole","Moltrix Tadpole","Bunblossom Tadpole","Jester Tadpole","Archangel Tadpole"
}

local Tadpoles = Shop:CreateDropdown({
    Name = "Tadpoles Trove",
    Options = TadpoleOptions,
    CurrentOption = {"None"},
    MultipleOptions = true,
    Flag = "Dropdown_Tadpoles",
    Callback = function(Value)
        ShopFrog = Value
    end
})

Shop:CreateButton({Name = "Select All Tadpoles", Callback = function()
    Tadpoles:Set(TadpoleOptions)
end})

-- Note: Auto Buy Tadpoles toggle was moved to Main (AutoBuy1 variable)

local RibbitDrop = Shop:CreateDropdown({Name = "Ribbit Rack", Options = RibbitList, CurrentOption = {"None"}, MultipleOptions = true, Flag = "Dropdown3", Callback = function(Value)
    ShopRibbit = Value
end})

Shop:CreateButton({Name = "Select All Ribbit", Callback = function()
    RibbitDrop:Set(RibbitList)
end})

Shop:CreateToggle({Name = "Auto Buy Ribbit", CurrentValue = false, Flag = "Toggle3", Callback = function(Value)
    AutoBuy3 = Value
end})

-- LOUNGE tab and dropdowns (Lilypad items sorted into categories)
local Lounge = Window:CreateTab("Lounge", 125058207637011)
Lounge:CreateSection("Lounge")

local ObjectsOptions = {
    "Barrel","Frogbreeze Chime","Fruit Crate","Ladder","Log","Log Sapling","Log Stack","Short Log",
    "Tree Trunk","Wooden Wheelbarrow","Shelf","Small Haystack","Large Haystack","Book Stack",
    "Wooden Bench","Book","Mossy Frog Hut","Mossmuffin Abode","Mushroom Cottage","Small Duck",
    "Duck","Acornwhisk Hut","Well","Watch Tower"
}

local PathwaysOptions = {
    "Cobble Path","Mossrock Path","Plank Steps","Rockleaf Path","Softwood Path","Stone Path",
    "Wornwood Path","Log Steps","Log Path","Brick Steps","Mosscobble Path","Pebblestone Path","Blossom Path"
}

local FencesOptions = {
    "Twigweave Fence","Wooden Fence","Mossrail Fence","Sproutstick Fence","Bloomtwig Fence"
}

local PlantsOptions = {
    "Giant Lilypad","Lilypad","Mushroom","Mushroom Cluster","Short Cattails","Starpetal Ferns",
    "Cattails","Dewdrop Lilies","Faelight Petals","Lilypad Umbrella","Bellblossoms","Lotus"
}

local RocksOptions = {
    "Rock cluster","Rocks","Small Rocks","Grass Mound","Mossy Rocks"
}

local BuildingsOptions = {
    "Plank Wall [1x1]","Plank Wall [3x1]","Plank Wall Plank Wall [3x2]","Wooden Pillar",
    "Wooden Wall [1x1]","Wooden Wall [3x1]","Wooden Wall [3x2]","Wooden Window",
    "Willowplank Wall [1x1]","Willowplank Wall [3x1]","Willowplank Wall [3x2]","Charwood Pillar",
    "Charwood Wall [3x1]","Charwood Wall [1x1]","Logstack Wall [1x1]","Logstack Wall [3x1]",
    "Logstack Wall [3x2]","Splitstone Wall [3x1]","Splitstone Wall [3x1]","Splitstone Wall [1x1]"
}

local ArchesOptions = {
    "Mossy Rock Arch","Rocky Arch","Wooden Arbor","Flower Ivy Arch","Rustic Wood Arbor",
    "Mushroom Arch","Willowvine Arch"
}

local LightingOptions = {
    "Mossy Latern","Latern","Stone Latern","Wooden Lamp Post","Candle","Candle Cluster",
    "Domeglow Lantern","Whisperlight Lantern","Firefly Lantern","Glowcap Lamp Post"
}

-- Variables to hold current selections
local LoungeObjects, LoungePathways, LoungeFences, LoungePlants, LoungeRocks, LoungeBuildings, LoungeArches, LoungeLighting =
    {}, {}, {}, {}, {}, {}, {}, {}

-- Create dropdowns (multiple choice)
local ddObjects = Lounge:CreateDropdown({Name = "Objects",   Options = ObjectsOptions,   CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Objects",   Callback = function(Value) LoungeObjects   = Value end})
local ddPath   = Lounge:CreateDropdown({Name = "Pathways",  Options = PathwaysOptions,  CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Pathways",  Callback = function(Value) LoungePathways  = Value end})
local ddFence  = Lounge:CreateDropdown({Name = "Fences",    Options = FencesOptions,    CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Fences",    Callback = function(Value) LoungeFences    = Value end})
local ddPlant  = Lounge:CreateDropdown({Name = "Plants",    Options = PlantsOptions,    CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Plants",    Callback = function(Value) LoungePlants    = Value end})
local ddRock   = Lounge:CreateDropdown({Name = "Rocks",     Options = RocksOptions,     CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Rocks",     Callback = function(Value) LoungeRocks     = Value end})
local ddBuild  = Lounge:CreateDropdown({Name = "Buildings", Options = BuildingsOptions, CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Buildings", Callback = function(Value) LoungeBuildings = Value end})
local ddArch   = Lounge:CreateDropdown({Name = "Arches",    Options = ArchesOptions,    CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Arches",    Callback = function(Value) LoungeArches    = Value end})
local ddLight  = Lounge:CreateDropdown({Name = "Lighting",  Options = LightingOptions,  CurrentOption = {"None"}, MultipleOptions = true, Flag = "Lounge_Lighting",  Callback = function(Value) LoungeLighting  = Value end})

-- Helper buttons: Select All and Clear All for convenience
Lounge:CreateButton({Name = "Select All All", Callback = function()
    ddObjects:Set(ObjectsOptions); ddPath:Set(PathwaysOptions); ddFence:Set(FencesOptions);
    ddPlant:Set(PlantsOptions); ddRock:Set(RocksOptions); ddBuild:Set(BuildingsOptions);
    ddArch:Set(ArchesOptions); ddLight:Set(LightingOptions)
end})

Lounge:CreateButton({Name = "Clear All Selections", Callback = function()
    ddObjects:Set({}); ddPath:Set({}); ddFence:Set({}); ddPlant:Set({}); ddRock:Set({}); ddBuild:Set({}); ddArch:Set({}); ddLight:Set({})
end})

-- Render loop: handle auto-buy logic for Tadpoles, Ribbit, Pickup, Sell, and Buy Lounge Items
RunService.RenderStepped:Connect(function(deltaTime)
    -- Tadpoles auto-buy (AutoBuy1 controlled by Main toggle "Auto Buy Tadpoles")
    if AutoBuy1 then
        for _, v in pairs(Frog) do
            if ShopFrog and table.find(ShopFrog, v[1]) and NumberCoverter(plr.leaderstats.Ribbles.Value) >= v[3] then
                pcall(function()
                    game:GetService("ReplicatedStorage"):WaitForChild("TadpoleShopComms"):WaitForChild("RF"):WaitForChild("OnPurchaseItem"):InvokeServer(v[1], v[2])
                end)
            end
        end
    end

    -- Ribbit auto-buy (unchanged)
    if AutoBuy3 then
        for _, v in pairs(Ribbit) do
            if ShopRibbit and table.find(ShopRibbit, v[1]) and NumberCoverter(plr.leaderstats.Ribbles.Value) >= v[2] then
                pcall(function()
                    game:GetService("ReplicatedStorage"):WaitForChild("GearShopComms"):WaitForChild("RF"):WaitForChild("OnPurchaseItem"):InvokeServer(v[1])
                end)
            end
        end
    end

    -- Auto pickup
    if AutoPickUp then
        for i, v in pairs(plr.Plot.Value.Entities:GetChildren()) do
            if v:IsA("Part") then
                game:GetService("ReplicatedStorage"):WaitForChild("FrogPickupComms"):WaitForChild("RE"):WaitForChild("Pickup"):FireServer(v)
            end
        end
    end

    -- Auto sell
    if AutoSell then
        game:GetService("ReplicatedStorage"):WaitForChild("HopNSellComms"):WaitForChild("RE"):WaitForChild("SellAll"):FireServer()
    end

    -- Buy Lounge Items: combine all selected lounge dropdowns and purchase matching Lilypad shop items
    if BuyLoungeItems then
        -- build a set of selected names for quick lookup
        local selected = {}
        for _, name in ipairs(LoungeObjects or {}) do selected[name] = true end
        for _, name in ipairs(LoungePathways or {}) do selected[name] = true end
        for _, name in ipairs(LoungeFences or {}) do selected[name] = true end
        for _, name in ipairs(LoungePlants or {}) do selected[name] = true end
        for _, name in ipairs(LoungeRocks or {}) do selected[name] = true end
        for _, name in ipairs(LoungeBuildings or {}) do selected[name] = true end
        for _, name in ipairs(LoungeArches or {}) do selected[name] = true end
        for _, name in ipairs(LoungeLighting or {}) do selected[name] = true end

        -- iterate Lilypad shop items and purchase if selected and affordable
        for _, item in pairs(Lilypad) do
            local itemName = item[1]
            local itemPrice = item[2] or 0
            if selected[itemName] and NumberCoverter(plr.leaderstats.Ribbles.Value) >= itemPrice then
                -- safe pcall to avoid errors if server call fails
                pcall(function()
                    game:GetService("ReplicatedStorage"):WaitForChild("LilypadLoungeComms"):WaitForChild("RF"):WaitForChild("OnPurchaseItem"):InvokeServer(itemName)
                end)
            end
        end
    end
end)
