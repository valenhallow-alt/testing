-- Safely destroy any previously created Rayfield UI (put this before loading the library)
if _G.RayfieldInstance then
    pcall(function()
        if type(_G.RayfieldInstance.Destroy) == "function" then
            _G.RayfieldInstance:Destroy()
        end
    end)
    _G.RayfieldInstance = nil
end

-- Load Rayfield library and create a minimal, blank window
local Rayfield = loadstring(game:HttpGet('https://raw.githubusercontent.com/UnHub-LEGO/Scripts/refs/heads/main/Rayfield%20Library'))()
_G.RayfieldInstance = Rayfield

local Window = Rayfield:CreateWindow({
    Name = "UnHub (Blank)",
    FileName = "UnHub_Blank",
    Icon = 0,
    Theme = "DarkBlue",
    ToggleUIKeybind = "H",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = nil,
        FileName = "UnHub_Blank"
    },
    Discord = {
        Enabled = false,
        Invite = "",
        RememberJoins = true
    },
    KeySystem = false,
    KeySettings = {
        Title = "UnHub",
        Subtitle = "Key",
        Note = "",
        FileName = "Key",
        SaveKey = false,
        GrabKeyFromSite = false,
        Key = {}
    }
})

-- =========================
-- New "Main" tab + toggle
-- =========================

-- Create a Main tab and a section for controls
local MainTab = Window:CreateTab("Main", 4483362458) -- Title, Image (use any valid image id or 0)
local MainSection = MainTab:CreateSection("Main Controls")

-- Placeholder global flag (ensures a defined value on load)
_G.AutoBuySpinEggs = _G.AutoBuySpinEggs or false

-- Create the Auto Buy+Spin Eggs toggle
local AutoBuySpinToggle = MainTab:CreateToggle({
    Name = "Auto Buy+Spin Eggs",
    CurrentValue = _G.AutoBuySpinEggs,
    Flag = "AutoBuySpinEggs",
    Callback = function(Value)
        _G.AutoBuySpinEggs = Value

        if Value then
            -- Start a background loop to perform the actions while enabled
            spawn(function()
                while _G.AutoBuySpinEggs do
                    pcall(function()
                        -- ======= IMPORTANT =======
                        -- Replace the placeholder calls below with the actual remote events/functions
                        -- used by the specific game you're targeting. The names used here are examples
                        -- and will not work unless they match the game's API.
                        --
                        -- Example placeholders:
                        -- local ReplicatedStorage = game:GetService("ReplicatedStorage")
                        -- local Remotes = ReplicatedStorage:WaitForChild("Remotes")
                        -- Remotes.BuyEgg:FireServer("EggName") -- buy an egg (replace "EggName")
                        -- Remotes.SpinEgg:FireServer() -- spin/claim the egg
                        --
                        -- If the game uses different remotes or functions, update these lines accordingly.
                        --
                        -- Keep the pcall to avoid runtime errors if the remote names are incorrect.
                        -- ==========================
                        
                        -- Placeholder: no-op (user must replace)
                        -- Example:
                        -- game:GetService("ReplicatedStorage").Remotes.BuyEgg:FireServer("BasicEgg")
                        -- game:GetService("ReplicatedStorage").Remotes.SpinEgg:FireServer()
                    end)
                    wait(1) -- adjust delay as needed to match desired frequency and avoid rate limits
                end
            end)
        end
    end,
})

-- Optionally expose the toggle object for later updates
_G.AutoBuySpinToggle = AutoBuySpinToggle

-- Minimal UI toggle button (draggable) to show/hide Rayfield
do
    local ST = Instance.new("ScreenGui")
    local T = Instance.new("ImageButton")
    local Corner = Instance.new("UICorner")

    ST.Name = "Toggle UnHub"
    -- Parent to the same UI context Rayfield uses so it appears alongside the Rayfield UI
    -- If Rayfield:GetParent() or its parent is nil, fall back to CoreGui
    local parentGui = nil
    pcall(function()
        parentGui = Rayfield:GetParent() and Rayfield:GetParent().Parent
    end)
    if not parentGui or not parentGui:IsA("Instance") then
        parentGui = game:GetService("CoreGui")
    end
    ST.Parent = parentGui
    ST.ResetOnSpawn = false

    T.Name = "UnHubToggle"
    T.Parent = ST
    T.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    T.Position = UDim2.new(0, 30, 0.08, 0)
    T.Size = UDim2.new(0, 50, 0, 50)
    T.Image = "rbxassetid://112045743772867" -- replace with your decal id if desired
    T.Active = true
    T.Draggable = true
    T.AutoButtonColor = true

    Corner.Name = "Corner"
    Corner.Parent = T
    Corner.CornerRadius = UDim.new(0, 8)

    -- Toggle Rayfield visibility on click
    T.MouseButton1Click:Connect(function()
        local ok, enabled = pcall(function() return Rayfield:GetEnable() end)
        if ok then
            pcall(function() Rayfield:SetEnable(not enabled) end)
        end
    end)
end

-- Load (or create) configuration so Rayfield can restore UI state if needed
pcall(function() Rayfield:LoadConfiguration() end)
